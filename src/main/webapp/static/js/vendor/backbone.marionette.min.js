/*!
 * Backbone.Marionette, v1.0.0-beta6
 * Copyright (c)2012 Derick Bailey, Muted Solutions, LLC.
 * Distributed under MIT license
 * http://github.com/marionettejs/backbone.marionette
*/
/*!
 * Includes BabySitter
 * https://github.com/marionettejs/backbone.babysitter/
 * Includes Wreqr
 * https://github.com/marionettejs/backbone.wreqr/
 * Includes EventBinder
 * https://github.com/marionettejs/backbone.eventbinder/
 */
Backbone.ChildViewContainer=(function(d,c){var a=function(e){this._views={};this._indexByModel={};this._indexByCollection={};this._indexByCustom={};this._updateLength()};c.extend(a.prototype,{add:function(e,g){var f=e.cid;this._views[f]=e;if(e.model){this._indexByModel[e.model.cid]=f}if(e.collection){this._indexByCollection[e.collection.cid]=f}if(g){this._indexByCustom[g]=f}this._updateLength()},findByModel:function(f){var e=this._indexByModel[f.cid];return this.findByCid(e)},findByCollection:function(f){var e=this._indexByCollection[f.cid];return this.findByCid(e)},findByCustom:function(f){var e=this._indexByCustom[f];return this.findByCid(e)},findByIndex:function(e){return c.values(this._views)[e]},findByCid:function(e){return this._views[e]},remove:function(e){var f=e.cid;if(e.model){delete this._indexByModel[e.model.cid]}if(e.collection){delete this._indexByCollection[e.collection.cid]}var h;for(var g in this._indexByCustom){if(this._indexByCustom.hasOwnProperty(g)){if(this._indexByCustom[g]===f){h=g;break}}}if(h){delete this._indexByCustom[h]}delete this._views[f];this._updateLength()},call:function(f,e){e=Array.prototype.slice.call(arguments,1);this.apply(f,e)},apply:function(g,f){var e;c.each(this._views,function(h,i){if(c.isFunction(h[g])){h[g].apply(h,f)}})},_updateLength:function(){this.length=c.size(this._views)}});var b=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty"];c.each(b,function(e){a.prototype[e]=function(){var f=c.values(this._views);var g=[f].concat(c.toArray(arguments));return c[e].apply(c,g)}});return a})(Backbone,_);Backbone.EventBinder=(function(e,c){var b={"default":{bindTo:function(h,f,j,g){g=g||this;h.on(f,j,g);var i={type:"default",obj:h,eventName:f,callback:j,context:g};return i},unbindFrom:function(f){f.obj.off(f.eventName,f.callback,f.context)}},jquery:{bindTo:function(h,f,j,g){g=g||this;j=c(j).bind(g);h.on(f,j);var i={type:"jquery",obj:h,eventName:f,callback:j,context:g};return i},unbindFrom:function(f){f.obj.off(f.eventName,f.callback)}}};function d(f){if(f.jquery){return b.jquery}return b["default"]}var a=function(){this._eventBindings=[]};a.extend=e.View.extend;c.extend(a.prototype,{bindTo:function(){var g=arguments[0];var f=d(g);var h=f.bindTo.apply(this,arguments);this._eventBindings.push(h);return h},unbindFrom:function(f){b[f.type].unbindFrom.apply(this,arguments);this._eventBindings=c.reject(this._eventBindings,function(g){return g===f})},unbindAll:function(){var f=c.map(this._eventBindings,c.identity);c.each(f,this.unbindFrom,this)}});return a})(Backbone,_);Backbone.Wreqr=(function(d,c,a){var b={};b.Handlers=(function(g,f){var e=function(){this._handlers={}};e.extend=g.Model.extend;f.extend(e.prototype,{addHandler:function(i,k,j){var h={callback:k,context:j};this._handlers[i]=h},getHandler:function(i){var h=this._handlers[i];if(!h){throw new Error("Handler not found for '"+i+"'")}return function(){return h.callback.apply(h.context,arguments)}},removeHandler:function(h){delete this._handlers[h]},removeAllHandlers:function(){this._handlers={}}});return e})(d,a);b.Commands=(function(e){return e.Handlers.extend({execute:function(g,f){this.getHandler(g)(f)}})})(b);b.RequestResponse=(function(e){return e.Handlers.extend({request:function(g,f){return this.getHandler(g)(f)}})})(b);b.EventAggregator=(function(g,e){var f=function(){};f.extend=g.Model.extend;e.extend(f.prototype,g.Events);return f})(d,a);return b})(Backbone,Backbone.Marionette,_);Backbone.Marionette=Marionette=(function(e,a,b){var d={};var c=Array.prototype.slice;d.extend=e.Model.extend;d.getOption=function(h,f){if(!h||!f){return}var g;if(h.options&&h.options[f]){g=h.options[f]}else{g=h[f]}return g};d.createObject=(function(){var f;function g(){}if(typeof Object.create==="function"){f=Object.create}else{f=function(h){g.prototype=h;var i=new g();g.prototype=null;return i}}return f})();d.triggerMethod=function(){var j=Array.prototype.slice.apply(arguments);var g=j[0];var h=g.split(":");var l,m,f="on";for(var k=0;k<h.length;k++){l=h[k];m=l.charAt(0).toUpperCase();f+=m+l.slice(1)}this.trigger.apply(this,arguments);if(a.isFunction(this[f])){j.shift();return this[f].apply(this,j)}};d.EventBinder=e.EventBinder.extend({augment:function(f){var g=new d.EventBinder();f.eventBinder=g;f.bindTo=a.bind(g.bindTo,g);f.unbindFrom=a.bind(g.unbindFrom,g);f.unbindAll=a.bind(g.unbindAll,g)}});d.addEventBinder=function(f){var g=new d.EventBinder();f.eventBinder=g;f.bindTo=a.bind(g.bindTo,g);f.unbindFrom=a.bind(g.unbindFrom,g);f.unbindAll=a.bind(g.unbindAll,g)};d.EventAggregator=e.Wreqr.EventAggregator.extend({constructor:function(){d.addEventBinder(this);e.Wreqr.EventAggregator.prototype.constructor.apply(this,arguments)}});d.Callbacks=function(){this._deferred=b.Deferred();this._callbacks=[]};a.extend(d.Callbacks.prototype,{add:function(g,f){this._callbacks.push({cb:g,ctx:f});this._deferred.done(function(i,h){if(f){i=f}g.call(i,h)})},run:function(f,g){this._deferred.resolve(g,f)},reset:function(){var g=this;var f=this._callbacks;this._deferred=b.Deferred();this._callbacks=[];a.each(f,function(h){g.add(h.cb,h.ctx)})}});d.TemplateCache=function(f){this.templateId=f};a.extend(d.TemplateCache,{templateCaches:{},get:function(f){var h=this;var g=this.templateCaches[f];if(!g){g=new d.TemplateCache(f);this.templateCaches[f]=g}return g.load()},clear:function(){var f;var g=arguments.length;if(g>0){for(f=0;f<g;f++){delete this.templateCaches[arguments[f]]}}else{this.templateCaches={}}}});a.extend(d.TemplateCache.prototype,{load:function(){var g=this;if(this.compiledTemplate){return this.compiledTemplate}var f=this.loadTemplate(this.templateId);this.compiledTemplate=this.compileTemplate(f);return this.compiledTemplate},loadTemplate:function(f){var g=b(f).html();if(!g||g.length===0){var i="Could not find template: '"+f+"'";var h=new Error(i);h.name="NoTemplateError";throw h}return g},compileTemplate:function(f){return a.template(f)}});d.Renderer={render:function(h,i){var g=typeof h==="function"?h:d.TemplateCache.get(h);var f=g(i);return f}};d.Controller=function(f){this.triggerMethod=d.triggerMethod;this.options=f||{};d.addEventBinder(this);if(a.isFunction(this.initialize)){this.initialize(this.options)}};d.Controller.extend=d.extend;a.extend(d.Controller.prototype,e.Events,{close:function(){this.unbindAll();this.triggerMethod("close");this.unbind()}});d.Region=function(f){this.options=f||{};d.addEventBinder(this);this.el=d.getOption(this,"el");if(!this.el){var g=new Error("An 'el' must be specified for a region.");g.name="NoElError";throw g}if(this.initialize){this.initialize.apply(this,arguments)}};a.extend(d.Region,{buildRegion:function(h,m){var l=(typeof h==="string");var k=(typeof h.selector==="string");var n=(typeof h.regionType==="undefined");var i=(typeof h==="function");if(!i&&!l&&!k){throw new Error("Region must be specified as a Region type, a selector string or an object with selector property")}var g,j;if(l){g=h}if(h.selector){g=h.selector}if(i){j=h}if(!i&&n){j=m}if(h.regionType){j=h.regionType}var f=new j({el:g});return f}});a.extend(d.Region.prototype,e.Events,{show:function(f){this.ensureEl();this.close();f.render();this.open(f);d.triggerMethod.call(f,"show");d.triggerMethod.call(this,"show",f);this.currentView=f},ensureEl:function(){if(!this.$el||this.$el.length===0){this.$el=this.getEl(this.el)}},getEl:function(f){return b(f)},open:function(f){this.$el.empty().append(f.el)},close:function(){var f=this.currentView;if(!f||f.isClosed){return}if(f.close){f.close()}d.triggerMethod.call(this,"close");delete this.currentView},attachView:function(f){this.currentView=f},reset:function(){this.close();delete this.$el}});d.Region.extend=d.extend;d.View=e.View.extend({constructor:function(){a.bindAll(this,"render");d.addEventBinder(this);e.View.prototype.constructor.apply(this,arguments);this.bindBackboneEntityTo(this.model,this.modelEvents);this.bindBackboneEntityTo(this.collection,this.collectionEvents);this.bindTo(this,"show",this.onShowCalled,this)},triggerMethod:d.triggerMethod,getTemplate:function(){return d.getOption(this,"template")},mixinTemplateHelpers:function(f){f=f||{};var g=this.templateHelpers;if(a.isFunction(g)){g=g.call(this)}return a.extend(f,g)},configureTriggers:function(){if(!this.triggers){return}var g=this;var h={};var f=a.result(this,"triggers");a.each(f,function(j,i){h[i]=function(k){if(k&&k.preventDefault){k.preventDefault()}if(k&&k.stopPropagation){k.stopPropagation()}g.trigger(j)}});return h},delegateEvents:function(f){f=f||this.events;if(a.isFunction(f)){f=f.call(this)}var h={};var g=this.configureTriggers();a.extend(h,f,g);e.View.prototype.delegateEvents.call(this,h)},onShowCalled:function(){},close:function(){if(this.isClosed){return}this.triggerMethod("before:close");this.remove();this.unbindAll();this.triggerMethod("close");this.isClosed=true},bindUIElements:function(){if(!this.ui){return}var f=this;if(!this.uiBindings){this.uiBindings=this.ui}this.ui={};a.each(a.keys(this.uiBindings),function(h){var g=f.uiBindings[h];f.ui[h]=f.$(g)})},bindBackboneEntityTo:function(g,h){if(!g||!h){return}var f=this;a.each(h,function(j,i){var k=f[j];if(!k){throw new Error("View method '"+j+"' was configured as an event handler, but does not exist.")}f.bindTo(g,i,k,f)})}});d.ItemView=d.View.extend({constructor:function(){d.View.prototype.constructor.apply(this,arguments);if(this.initialEvents){this.initialEvents()}},serializeData:function(){var f={};if(this.model){f=this.model.toJSON()}else{if(this.collection){f={items:this.collection.toJSON()}}}return f},render:function(){this.isClosed=false;this.triggerMethod("before:render",this);this.triggerMethod("item:before:render",this);var h=this.serializeData();h=this.mixinTemplateHelpers(h);var g=this.getTemplate();var f=d.Renderer.render(g,h);this.$el.html(f);this.bindUIElements();this.triggerMethod("render",this);this.triggerMethod("item:rendered",this);return this},close:function(){if(this.isClosed){return}this.triggerMethod("item:before:close");d.View.prototype.close.apply(this,arguments);this.triggerMethod("item:closed")}});d.CollectionView=d.View.extend({constructor:function(f){this.initChildViewStorage();d.View.prototype.constructor.apply(this,arguments);this.initialEvents();this.onShowCallbacks=new d.Callbacks();if(f&&f.itemViewOptions){this.itemViewOptions=f.itemViewOptions}},initialEvents:function(){if(this.collection){this.bindTo(this.collection,"add",this.addChildView,this);this.bindTo(this.collection,"remove",this.removeItemView,this);this.bindTo(this.collection,"reset",this.render,this)}},addChildView:function(i,j,g){this.closeEmptyView();var h=this.getItemView(i);var f;if(g&&g.index){f=g.index}else{f=0}return this.addItemView(i,h,f)},onShowCalled:function(){this.onShowCallbacks.run()},triggerBeforeRender:function(){this.triggerMethod("before:render",this);this.triggerMethod("collection:before:render",this)},triggerRendered:function(){this.triggerMethod("render",this);this.triggerMethod("collection:rendered",this)},render:function(){this.isClosed=false;this.triggerBeforeRender();this.closeEmptyView();this.closeChildren();if(this.collection&&this.collection.length>0){this.showCollection()}else{this.showEmptyView()}this.triggerRendered();return this},showCollection:function(){var g=this;var f;this.collection.each(function(i,h){f=g.getItemView(i);g.addItemView(i,f,h)})},showEmptyView:function(){var g=d.getOption(this,"emptyView");if(g&&!this._showingEmptyView){this._showingEmptyView=true;var f=new e.Model();this.addItemView(f,g,0)}},closeEmptyView:function(){if(this._showingEmptyView){this.closeChildren();delete this._showingEmptyView}},getItemView:function(h){var f=d.getOption(this,"itemView");if(!f){var g=new Error("An `itemView` must be specified");g.name="NoItemViewError";throw g}return f},addItemView:function(j,i,g){var h=this;var k;if(a.isFunction(this.itemViewOptions)){k=this.itemViewOptions(j)}else{k=this.itemViewOptions}var f=this.buildItemView(j,i,k);this.children.add(f);this.triggerMethod("item:added",f);var m=this.bindTo(f,"all",function(){var n=c.call(arguments);n[0]="itemview:"+n[0];n.splice(1,0,f);h.triggerMethod.apply(h,n)});this.childBindings=this.childBindings||{};this.childBindings[f.cid]=m;var l=this.renderItemView(f,g);if(f.onShow){this.onShowCallbacks.add(f.onShow,f)}return l},renderItemView:function(f,g){f.render();this.appendHtml(this,f,g)},buildItemView:function(i,g,j){var h=a.extend({model:i},j);var f=new g(h);return f},removeItemView:function(g){var f=this.children.findByModel(g);if(f){var h=this.childBindings[f.cid];if(h){this.unbindFrom(h);delete this.childBindings[f.cid]}if(f.close){f.close()}this.children.remove(f)}if(!this.collection||this.collection.length===0){this.showEmptyView()}this.triggerMethod("item:removed",f)},appendHtml:function(f,h,g){f.$el.append(h.el)},initChildViewStorage:function(){this.children=new e.ChildViewContainer()},close:function(){if(this.isClosed){return}this.triggerMethod("collection:before:close");this.closeChildren();this.triggerMethod("collection:closed");d.View.prototype.close.apply(this,arguments)},closeChildren:function(){var f=this;this.children.apply("close");this.initChildViewStorage()}});d.CompositeView=d.CollectionView.extend({constructor:function(f){d.CollectionView.apply(this,arguments);this.itemView=this.getItemView()},initialEvents:function(){if(this.collection){this.bindTo(this.collection,"add",this.addChildView,this);this.bindTo(this.collection,"remove",this.removeItemView,this);this.bindTo(this.collection,"reset",this.renderCollection,this)}},getItemView:function(h){var f=d.getOption(this,"itemView")||this.constructor;if(!f){var g=new Error("An `itemView` must be specified");g.name="NoItemViewError";throw g}return f},serializeData:function(){var f={};if(this.model){f=this.model.toJSON()}return f},render:function(){this.isClosed=false;this.resetItemViewContainer();var f=this.renderModel();this.$el.html(f);this.bindUIElements();this.triggerMethod("composite:model:rendered");this.renderCollection();this.triggerMethod("composite:rendered");return this},renderCollection:function(){d.CollectionView.prototype.render.apply(this,arguments);this.triggerMethod("composite:collection:rendered")},renderModel:function(){var g={};g=this.serializeData();g=this.mixinTemplateHelpers(g);var f=this.getTemplate();return d.Renderer.render(f,g)},appendHtml:function(f,g){var h=this.getItemViewContainer(f);h.append(g.el)},getItemViewContainer:function(i){if("$itemViewContainer" in i){return i.$itemViewContainer}var g;if(i.itemViewContainer){var f=a.result(i,"itemViewContainer");g=i.$(f);if(g.length<=0){var h=new Error("The specified `itemViewContainer` was not found: "+i.itemViewContainer);h.name="ItemViewContainerMissingError";throw h}}else{g=i.$el}i.$itemViewContainer=g;return g},resetItemViewContainer:function(){if(this.$itemViewContainer){delete this.$itemViewContainer}}});d.Layout=d.ItemView.extend({regionType:d.Region,constructor:function(){this._firstRender=true;this.initializeRegions();e.Marionette.ItemView.apply(this,arguments)},render:function(){if(this._firstRender){this._firstRender=false}else{this.closeRegions();this.reInitializeRegions()}var f=d.ItemView.prototype.render.apply(this,arguments);return f},close:function(){if(this.isClosed){return}this.closeRegions();this.destroyRegions();e.Marionette.ItemView.prototype.close.call(this,arguments)},initializeRegions:function(){if(!this.regionManagers){this.regionManagers={}}var f=this;var g=this.regions||{};a.each(g,function(i,h){var j=d.Region.buildRegion(i,f.regionType);j.getEl=function(k){return f.$(k)};f.regionManagers[h]=j;f[h]=j})},reInitializeRegions:function(){if(this.regionManagers&&a.size(this.regionManagers)===0){this.initializeRegions()}else{a.each(this.regionManagers,function(f){f.reset()})}},closeRegions:function(){var f=this;a.each(this.regionManagers,function(h,g){h.close()})},destroyRegions:function(){var f=this;a.each(this.regionManagers,function(h,g){delete f[g]});this.regionManagers={}}});d.AppRouter=e.Router.extend({constructor:function(g){e.Router.prototype.constructor.apply(this,arguments);this.options=g;if(this.appRoutes){var f=d.getOption(this,"controller");this.processAppRoutes(f,this.appRoutes)}},processAppRoutes:function(k,l){var f,n;var o,m,j;var p=[];var q=this;for(o in l){if(l.hasOwnProperty(o)){p.unshift([o,l[o]])}}m=p.length;for(j=0;j<m;j++){o=p[j][0];n=p[j][1];f=k[n];if(!f){var g="Method '"+n+"' was not found on the controller";var h=new Error(g);h.name="NoMethodError";throw h}f=a.bind(f,k);q.route(o,n,f)}}});d.Application=function(f){this.initCallbacks=new d.Callbacks();this.vent=new d.EventAggregator();this.commands=new e.Wreqr.Commands();this.reqres=new e.Wreqr.RequestResponse();this.submodules={};a.extend(this,f);d.addEventBinder(this);this.triggerMethod=d.triggerMethod};a.extend(d.Application.prototype,e.Events,{execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(f){this.initCallbacks.add(f)},start:function(f){this.triggerMethod("initialize:before",f);this.initCallbacks.run(f,this);this.triggerMethod("initialize:after",f);this.triggerMethod("start",f)},addRegions:function(g){var f=this;a.each(g,function(i,h){var j=d.Region.buildRegion(i,d.Region);f[h]=j})},removeRegion:function(f){this[f].close();delete this[f]},module:function(f,h){var g=c.call(arguments);g.unshift(this);return d.Module.create.apply(d.Module,g)}});d.Application.extend=d.extend;d.Module=function(f,g){this.moduleName=f;this.submodules={};this._setupInitializersAndFinalizers();this.config={};this.config.app=g;d.addEventBinder(this)};a.extend(d.Module.prototype,e.Events,{addInitializer:function(f){this._initializerCallbacks.add(f)},addFinalizer:function(f){this._finalizerCallbacks.add(f)},start:function(f){if(this._isInitialized){return}a.each(this.submodules,function(g){var h=true;if(g.config&&g.config.options){h=g.config.options.startWithParent}if(h){g.start(f)}});this._initializerCallbacks.run(f,this);this._isInitialized=true},stop:function(){if(!this._isInitialized){return}this._isInitialized=false;a.each(this.submodules,function(f){f.stop()});this._finalizerCallbacks.run();this._initializerCallbacks.reset();this._finalizerCallbacks.reset()},addDefinition:function(f,g){this._runModuleDefinition(f,g)},_runModuleDefinition:function(g,h){if(!g){return}var f=a.flatten([this,this.config.app,e,d,b,a,h]);g.apply(this,f)},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new d.Callbacks();this._finalizerCallbacks=new d.Callbacks()}});a.extend(d.Module,{create:function(l,f,g){var j=this;var k=l;f=f.split(".");var i=c.apply(arguments);i.splice(0,3);var h=f.length;a.each(f,function(o,q){var m=(q===h-1);var n=(q===0);var p=j._getModuleDefinition(k,o,l);if(m){p.config.options=j._getModuleOptions(p,k,g);if(p.config.options.hasDefinition){p.addDefinition(p.config.options.definition,i)}}if(n&&m){j._configureStartWithApp(l,p)}k=p});return k},_configureStartWithApp:function(g,f){if(f.config.startWithAppIsConfigured){return}g.addInitializer(function(h){if(f.config.options.startWithParent){f.start(h)}});f.config.startWithAppIsConfigured=true},_getModuleDefinition:function(h,f,i){var g=h[f];if(!g){g=new d.Module(f,i);h[f]=g;h.submodules[f]=g}return g},_getModuleOptions:function(h,j,g){var i=true;if(h.config.options&&!h.config.options.startWithParent){i=false}var f={startWithParent:i,hasDefinition:!!g};if(!f.hasDefinition){return f}if(a.isFunction(g)){f.definition=g}else{f.hasDefinition=!!g.define;f.definition=g.define;if(g.hasOwnProperty("startWithParent")){f.startWithParent=g.startWithParent}}return f}});return d})(Backbone,_,$||window.jQuery||window.Zepto||window.ender);